{% capture thumbnails %}
  {% if product.media.size > 1 %}
    {% assign thumb_slider = "" %}
    {% assign thumb_grid_width = "" %}
    {% assign thumb_type = "" %}
    {% if thumbnail_position != 'bottom' %}
     {% assign thumb_type = "bx" %}
     {% assign thumb_grid_width = "vertical-carousel desktop-2 tablet-1 mobile-hide" %}
    {% else %}
     {% assign thumb_type = "flexslider" %}
     {% assign thumb_grid_width = "desktop-12 tablet-6 mobile-hide" %}
    {% endif %}
    {% if product.media.size > 4 %}
      {% assign thumb_slider = "thumbnail-slider" %}
    {% endif %}
    <div id="thumbnail-gallery"
    class="{{ thumb_type }} {{ thumb_grid_width }} {{ thumb_slider }}"
    data-thumbnail-position="{{ thumbnail_position }}" data-thumbnail-type="{{ thumb_type }}">
      <ul class="slides product-single__thumbnails-{{ section.id }}">
        {% for media in product.media %}
          {% assign img_url = media | img_url: '1x1' | replace: '_1x1.', '_{width}x.' %}
          <li class="{{ media.media_type }}-thumbnail product-single__thumbnails-item" data-image-id="{{ media.id }}">
            <a href="{{ media.preview_image | img_url: product_image_zoom_size, scale: product_image_scale }}"
               class="text-link product-single__thumbnail product-single__thumbnail--{{ section.id }}"
               data-thumbnail-id="{{ section.id }}-{{ media.id }}">
              <img class="lazyload lazyload-fade"
                src="{{ media | img_url: '150x' }}"
                data-src="{{ img_url }}"
                data-sizes="auto"
                data-image-id="{{ media.id }}"
                alt="{{ media.alt | escape }}">
              <noscript>
                <img src="{{ media | img_url: '100x' }}" alt="{{ media.alt | escape }}" />
              </noscript>
              {%- if media.media_type == 'video' or media.media_type =='external_video' -%}
                <div class="thumbnail-icon">
                  {% include 'media-icons', width: '25', icon: 'play' %}
                </div>
              {%- endif -%}
              {%- if media.media_type == 'model' -%}
                <div class="thumbnail-icon">
                  {% include 'media-icons', width: '25', icon: '3d-icon' %}
                </div>
              {%- endif -%}
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
{% endcapture %}

{% capture slider %}
  {% assign grid_width = "" %}
  {% if product.media.size > 1 and thumbnail_position != 'bottom' %}
   {% assign grid_width = "desktop-10 tablet-5 mobile-3" %}
  {% else %}
   {% assign grid_width = "desktop-12 tablet-6 mobile-3" %}
  {% endif %}
  <div id="slider" class="flexslider {{ grid_width }}">
    <ul class="slides product-image-container">
      {% for media in product.media %}
        <li class="{{ media.media_type }}-slide" data-image-id="{{ media.id }}" data-flex-index="{{ forloop.index0 }}">
          <div class="product-media-container product-media--{{ media.id }}"
          data-product-single-media-wrapper
          {% if media.media_type == 'video' %} data-product-media-type-video data-enable-video-looping="{{ enable_video_looping }}"{% endif %}
          {% if media.media_type == 'external_video' %}data-product-media-type-video data-enable-video-looping="{{ enable_video_looping }}" data-video-id="{{ media.external_id }}"{% endif %}
          {% if media.media_type == 'model' %} data-product-media-type-model{% endif %}
          data-thumbnail-id="{{ section.id }}-{{ media.id }}"
          data-media-id="{{ section.id }}-{{ media.id }}">
            {% case media.media_type %}
              {% when 'image' %}
                {% assign img_url = media | img_url: '1x1' | replace: '_1x1.', '_{width}x.' %}
                <a class="product-fancybox" rel="product-images" href="{{ media | img_url: '2400x' }}">
                  <img id="{{ product.id }}" class="product__image lazyload lazyload-fade"
                    src="{{ media | img_url: '800x' }}"
                    data-src="{{ img_url }}"
                    data-sizes="auto"
                    data-zoom-src="{{ media | img_url: '2400x' }}"
                    data-aspectratio="{{ media.preview_image.aspect_ratio }}"
                    alt="{{ media.alt | escape }}">
                </a>
              {% when 'external_video' %}
                <div class="product-video videoWrapper">
                  {{ media | external_video_tag }}
                </div>
              {% when 'video' %}
                {% style %}
                  @media screen and (max-width: 320px) {
                    .product-media--{{ media.id }} .plyr__poster {
                      background-image: url({{ media.preview_image | img_url: '360x'}}) !important;
                    }
                  }
                  @media screen and (min-width: 320px) and (max-width: 780px) {
                    .product-media--{{ media.id }} .plyr__poster {
                      background-image: url({{ media.preview_image | img_url: '900x'}}) !important;
                    }
                  }
                  @media screen and (min-width: 780px) and (max-width: 1080px) {
                    .product-media--{{ media.id }} .plyr__poster {
                      background-image: url({{ media.preview_image | img_url: '1080x'}}) !important;
                    }
                  }
                  @media screen and (min-width: 1080px) {
                    .product-media--{{ media.id }} .plyr__poster {
                      background-image: url({{ media.preview_image | img_url: '2048x'}}) !important;
                    }
                  }
                {% endstyle %}
                <div class="product-video">
                  {{ media | video_tag: controls: true, class: 'media-video', image_size: '800x' }}
                </div>
              {% when 'model' %}
                <div class="product-model" style="padding-bottom: 100%">
                  {{ media | model_viewer_tag: image_size: '800x', reveal: 'interaction', toggleable: true, data-model-id: media.id}}
                </div>
            {% endcase %}
          </div>
          <noscript>
            <img id="{{ product.id }}" class="product-main-image" src="{{ featured_media | img_url: '800x' }}" alt='{{ media.alt | escape }}'/>
          </noscript>
          {% assign first_3d_model = product.media | where: "media_type", "model" | first %}
          {%- if first_3d_model -%}
            <button
              aria-label="{{ 'products.product.view_in_space_label' | t }}"
              class="media-button product-single__view-in-space"
              data-shopify-xr
              data-shopify-model3d-id="{{ first_3d_model.id }}"
              data-shopify-title="{{ product.title }}"
              data-shopify-xr-hidden
            >
              {% include 'media-icons', width: '25', icon: '3d-icon' %}<span class='product-single__view-in-space-text'>{{ 'products.product.view_in_space' | t }}</span>
            </button>
          {%- endif -%}
        </li>
      {% endfor %}
    </ul>
  </div>
{% endcapture %}

{%- if thumbnail_position == 'left' -%}
  {{ thumbnails }}
{%- endif -%}

{{ slider }}

{%- if thumbnail_position == 'right' or thumbnail_position == 'bottom' -%}
  {{ thumbnails }}
{%- endif -%}
